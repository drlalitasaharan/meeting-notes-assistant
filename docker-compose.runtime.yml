services:
  backend:
    command: >
      sh -lc 'alembic -c alembic.ini upgrade head &&
              uvicorn app.main:app --host 0.0.0.0 --port 8000'
  worker:
    command: >
      sh -lc 'rq worker default -u $$REDIS_URL'
    volumes:
      - ./backend:/app/backend     # mount code so worker sees app.jobs.*
    environment:
      PYTHONPATH: /app/backend     # make "app" importable
